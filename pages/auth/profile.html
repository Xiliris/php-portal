{{navbar}}
<div id="profile">
  <div id="profile-information" class="profile-container">
    <h1>Profile</h1>
    <div>
      <h4>Username</h4>
      <p id="username"></p>
    </div>
    <div>
      <h4>Email</h4>
      <p id="email"></p>
    </div>
    <div>
      <h4>Role</h4>
      <p id="role"></p>
    </div>
    <div id="profile-inner-container">
      <a href="/change-password" class="btn-primary">Change Password</a>
      <a href="/logout" class="btn-primary">Logout</a>
    </div>
  </div>
</div>
{{footer}}

<script>
  async function fetchUserData() {
    try {
      const response = await fetch("/api/routes/user.php", {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          Accept: "application/json",
        },
      });

      if (!response.ok) {
        console.error("Network response was not ok:", response.statusText);
        throw new Error("Network response was not ok.");
      }

      const data = await response.json();

      if (data.success) {
        document.querySelector(
          "#profile #username"
        ).innerText = `${data.user.username}`;
        document.querySelector(
          "#profile #email"
        ).innerText = `${data.user.email}`;
        document.querySelector(
          "#profile #role"
        ).innerText = `${data.user.role}`;

        if (data.user.role === "admin" || data.user.role === "owner") {
          document.querySelector(
            "#profile-inner-container"
          ).innerHTML += `<a href="/dashboard" class="btn-fortiary">Dashboard</a>`;
        }

        if (data.user.role === "owner") {
          document.querySelector(
            "#profile-inner-container"
          ).innerHTML += `<a href="/master-panel" class="btn-fortiary">Master Panel</a>`;
        }
      } else {
        document.querySelector(
          "#profile"
        ).innerHTML += `<p>${data.message}</p>`;
      }
    } catch (error) {
      console.error("Error fetching user data:", error);
      document.querySelector("#profile").innerHTML +=
        "<p>Unable to fetch user data. Please try again later.</p>";
    }
  }

  (async () => {
    await fetchUserData();
  })();
</script>

<style>
  #profile {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 2rem;
    margin: 0 auto;
    height: 100vh;
  }

  .profile-container {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    border: 1px solid #ccc;
    border-radius: 12px;
    padding: 2rem;
    width: 400px;
  }

  .profile-container p {
    font-size: 1.2rem;
  }

  #profile-inner-container {
    border-top: 1px solid #ccc;
    padding-top: 1rem;
    display: grid;
    grid-row: repeat(2, 1fr);
    grid-column: repeat(2, 1fr);
    gap: 1rem;
  }
</style>
