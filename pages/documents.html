{{navbar}}
<h1 id="h1el">Uploaded Documents</h1>
<div id="documents">
    <div id="error-message"></div>
</div>
{{footer}}

<script>
    async function fetchDocuments() {
        const queryParams = new URLSearchParams(window.location.search);
        const profileId = queryParams.get("id");

        const errorMessageDiv = document.getElementById('error-message');
        try {
            const response = await fetch(`/api/routes/documents.php?id=${profileId}`);
            if (!response.ok) {
                const errorData = await response.text();
                throw new Error(errorData);
            }
            const data = await response.json();
            const documentsDiv = document.getElementById('documents');
            documentsDiv.innerHTML = '';

            if (data.message) {
                documentsDiv.innerHTML = `<p>${data.message}</p>`;
            } else {
                data.forEach(doc => {
                    const docDiv = document.createElement('div');
                    docDiv.className = 'document';

                    const viewUrl = `../api/routes/documents.php?file=${encodeURIComponent(doc.name)}&action=view`;
                    const downloadUrl = `../api/routes/documents.php?file=${encodeURIComponent(doc.name)}&action=download`;

                    let preview;
                    if (doc.type === 'pdf') {
                        preview = `<embed src="${viewUrl}" width="100%" height="500" type="application/pdf" />`;
                    } else if (doc.type === 'docx') {
                        preview = `<iframe src="${viewUrl}" width="100%" height="500"></iframe>`;
                    } else {
                        preview = '<p>Preview not supported for this file type.</p>';
                    }

                    docDiv.innerHTML = `
                        <h2>Document: ${doc.name}</h2>
                        <a href="${downloadUrl}" download>Download</a><br>
                        ${preview}
                    `;
                    documentsDiv.appendChild(docDiv);
                });
            }
        } catch (error) {
            errorMessageDiv.textContent = error.message;
        }
    }

    fetchDocuments();
</script>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
    }

    #h1el {
        margin-top: 10%;
        margin-bottom: 3%;
        text-align: center;
    }

    #documents {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 20px;
    }

    #error-message {
        color: red;
    }

    .document {
        display: flex;
        flex-direction: column;
        align-items: start;
        text-align: left;
        margin-bottom: 20px;
        border: 1px solid #ccc;
        padding: 10px;
        width: 100%;
        max-width: 600px;
    }

    p {
        margin-bottom: 5%;
    }

    @media (max-width: 853px) {
        #h1el {
            margin-top: 15%;
        }

        .document {
            padding: 10px;
            width: 90%;
        }

        .document embed,
        .document iframe {
            height: 400px;
        }
    }

    @media (max-width: 540px) {
        #h1el {
            font-size: 1.5em;
            margin-top: 25%;
        }

        .document {
            padding: 5px;
            width: 100%;
        }

        .document embed,
        .document iframe {
            height: 300px;
        }
    }

    @media (max-width: 375px) {
        #h1el {
            font-size: 1.2em;
            margin-top: 30%;
        }

        .document {
            padding: 5px;
            width: 100%;
        }

        .document embed,
        .document iframe {
            height: 250px;
        }
    }
</style>